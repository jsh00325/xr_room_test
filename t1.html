<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>XR Furniture Mockup</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        canvas { display: block; }
        
        /* 오퍼레이터용 UI (실제 시연 시에는 숨기거나 투명하게 설정 가능) */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: sans-serif;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
        }
        .instruction { font-size: 14px; margin-bottom: 5px; opacity: 0.8; }
        .key { font-weight: bold; color: #4facfe; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="instruction"><span class="key">[1]</span> TV 추가 (무빙스타일)</div>
        <div class="instruction"><span class="key">[2]</span> 에어컨 교체 (벽걸이 -> 스탠드)</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. 씬(Scene) 설정
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020); // 어두운 방 분위기
        // 안개 효과로 깊이감 추가
        scene.fog = new THREE.Fog(0x202020, 5, 20);

        // 2. 카메라 설정
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 4); // 사람 눈높이 (1.6m)에서 약간 뒤로

        // 3. 렌더러 설정
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // 그림자 활성화
        document.body.appendChild(renderer.domElement);

        // 4. 조명 설정
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); // 전체 조명
        scene.add(ambientLight);

        const spotLight = new THREE.SpotLight(0xffffff, 0.8);
        spotLight.position.set(5, 10, 5);
        spotLight.castShadow = true;
        scene.add(spotLight);

        // 5. 기본 룸 환경 (바닥 및 벽)
        const floorGeo = new THREE.PlaneGeometry(10, 10);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x808080, roughness: 0.8 });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        const wallGeo = new THREE.PlaneGeometry(10, 5);
        const wallMat = new THREE.MeshStandardMaterial({ color: 0xa0a0a0 });
        const backWall = new THREE.Mesh(wallGeo, wallMat);
        backWall.position.set(0, 2.5, -5);
        backWall.receiveShadow = true;
        scene.add(backWall);

        // --- 가구 객체 생성 함수들 (나중에 GLB 모델 로더로 교체 가능) ---

        // 소파 생성 (기본 배치)
        function createSofa() {
            const group = new THREE.Group();
            
            // 소파 몸통
            const baseGeo = new THREE.BoxGeometry(2.5, 0.5, 1);
            const mat = new THREE.MeshStandardMaterial({ color: 0x8B4513 }); // 갈색
            const base = new THREE.Mesh(baseGeo, mat);
            base.position.y = 0.25;
            base.castShadow = true;
            
            // 등받이
            const backGeo = new THREE.BoxGeometry(2.5, 0.6, 0.2);
            const back = new THREE.Mesh(backGeo, mat);
            back.position.set(0, 0.8, -0.4);
            back.castShadow = true;

            group.add(base, back);
            group.position.set(0, 0, -3); // 벽 쪽에 배치
            return group;
        }

        // 벽걸이 에어컨 생성 (초기 상태)
        function createWallAC() {
            const geo = new THREE.BoxGeometry(1.2, 0.4, 0.3);
            const mat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(2, 4, -4.8); // 우측 상단 벽
            mesh.castShadow = true;
            return mesh;
        }

        // 스탠드 에어컨 생성 (교체용)
        function createStandAC() {
            const geo = new THREE.BoxGeometry(0.5, 2.2, 0.5);
            const mat = new THREE.MeshStandardMaterial({ color: 0xe0e0e0 }); // 은은한 흰색
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(3, 1.1, -4); // 우측 구석
            mesh.castShadow = true;
            mesh.visible = false; // 처음엔 안 보임
            return mesh;
        }

        // TV (무빙스타일/더세로 느낌) 생성 (추가용)
        function createMovingTV() {
            const group = new THREE.Group();

            // 스탠드 다리
            const standGeo = new THREE.CylinderGeometry(0.1, 0.3, 1, 32);
            const darkMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
            const stand = new THREE.Mesh(standGeo, darkMat);
            stand.position.y = 0.5;

            // TV 화면 (세로형 가정)
            const screenGeo = new THREE.BoxGeometry(0.8, 1.4, 0.05);
            const screenMat = new THREE.MeshStandardMaterial({ color: 0x000000 });
            const screen = new THREE.Mesh(screenGeo, screenMat);
            screen.position.y = 1.2 + 0.5;
            
            group.add(stand, screen);
            group.position.set(-2, 0, -2); // 좌측 앞쪽 배치
            group.rotation.y = Math.PI / 6; // 살짝 회전
            group.visible = false; // 처음엔 안 보임
            return group;
        }

        // --- 객체 배치 ---
        const sofa = createSofa();
        const wallAC = createWallAC();
        const standAC = createStandAC();
        const tv = createMovingTV();

        scene.add(sofa);
        scene.add(wallAC);
        scene.add(standAC);
        scene.add(tv);

        // --- 인터랙션 로직 (키보드 이벤트) ---
        window.addEventListener('keydown', (e) => {
            // 시나리오 1: TV 추가 (키보드 1번)
            if (e.key === '1') {
                console.log("Scenario 1: Adding TV");
                tv.visible = true;
                // 나타날 때 간단한 애니메이션 효과 (Scale Up)
                tv.scale.set(0.1, 0.1, 0.1);
                let scale = 0.1;
                const animateIn = setInterval(() => {
                    scale += 0.1;
                    tv.scale.set(scale, scale, scale);
                    if (scale >= 1) clearInterval(animateIn);
                }, 20);
            }

            // 시나리오 2: 에어컨 교체 (키보드 2번)
            if (e.key === '2') {
                console.log("Scenario 2: Replacing AC");
                wallAC.visible = false;  // 기존 에어컨 숨김
                standAC.visible = true;  // 새 에어컨 표시
                
                // 나타나는 애니메이션
                standAC.scale.set(1, 0.1, 1);
                let scaleY = 0.1;
                const animateSwap = setInterval(() => {
                    scaleY += 0.1;
                    standAC.scale.set(1, scaleY, 1);
                    if (scaleY >= 1) clearInterval(animateSwap);
                }, 20);
            }
        });

        // --- 렌더링 루프 ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // 화면 크기 조정 대응
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
